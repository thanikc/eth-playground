<html>
  <head>
     <title>Introduction to Dapps. Simple MetaMask example.</title>
     <script type="text/javascript" src="./bower_components/web3/dist/web3.min.js"></script>
  </head>
  <body>
  <p>
    This example is taken from <a href="https://citywebconsultants.co.uk/blog/blockchain/introducing-ethereum-development-part-1-metamask-and-web3">this</a> tutorial.
  </p>
  <table>
    <tr><td>Coinbase:</td><td id="coinbase"></td></tr>
    <tr><td>Balance:</td><td id="balance"></td></tr>
  </table>
  <fieldset>
    <label> Ether:
      <input type="text" id="amount"></input>
    </label>
    <button onclick="send()">Donate</button>
    <div id="response"></div>
  </fieldset>
  <div id="transaction"></div>
  <table>
    <tr><td>Receipient:</td><td id="receipientAccount"></td></tr>
    <tr><td>Balance:</td><td id="receipientBalance"></td></tr>
  </table>

  <script>
    var receipientAccount;
    

    function updateBalance() {
      document.getElementById('balance').textContent = web3.eth.getBalance(web3.eth.coinbase) / 1000000000000000000;
      document.getElementById('receipientBalance').textContent = web3.eth.getBalance(receipientAccount) / 1000000000000000000;
    }

    window.onload = function() {
      if (typeof web3 !== 'undefined') {
        web3 = new Web3(web3.currentProvider);
      } else {
        web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));

        receipientAccount = web3.eth.accounts[9];

        document.getElementById('coinbase').textContent = web3.eth.coinbase;
        document.getElementById('receipientAccount').textContent = receipientAccount;
        updateBalance();
      }
    }

    function send() {
      web3.eth.sendTransaction({
        from: web3.eth.coinbase,
        to: receipientAccount,
        value: web3.toWei(document.getElementById("amount").value, 'ether')
      }, function(error, result) {
        if (!error) {
          document.getElementById('transaction').innerHTML = 'Transaction: <pre>' + JSON.stringify( web3.eth.getTransaction(result), null, 2 ) + '</pre>';
          updateBalance();
        } else {
          document.getElementById('response').innerHTML = '<pre>' + error + '</pre>'
        }
      })
    }
  </script>
  </body>
</html>
